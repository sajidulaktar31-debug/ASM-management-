<!DOCTYPE html>
<html>
<head>
<title>Aktar Super Mart â€“ POS & Inventory</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f4f4f4;margin:0;padding:10px}
.box{max-width:380px;margin:80px auto;background:#fff;padding:20px;border-radius:8px}
.hidden{display:none}
input,button{width:100%;padding:10px;margin:6px 0}
button{border:none;color:#fff;font-size:15px}
.green{background:#28a745}
.blue{background:#007bff}
.red{background:#dc3545}
.gray{background:#6c757d}
table{width:100%;border-collapse:collapse;margin-top:10px}
td,th{border:1px solid #ccc;padding:6px;text-align:center}
.low{color:red;font-weight:bold}
.auditBox{background:#fff;padding:10px;border-radius:8px}
</style>
</head>

<body>

<!-- ğŸ” LOGIN -->
<div id="loginBox" class="box">
<h3>ğŸ” Owner Login</h3>
<input id="uid" placeholder="ID Card Number">
<input id="pass" type="password" placeholder="Password">
<button class="green" onclick="login()">Login</button>
<p id="msg" style="color:red"></p>
</div>

<!-- ğŸ§¾ DASHBOARD -->
<div id="dashboard" class="hidden">

<button class="red" onclick="logout()">Logout</button>
<h2>ğŸ§¾ Aktar Super Mart POS</h2>

<input id="barcode" placeholder="Scan Barcode">
<input id="qty" type="number" value="1" min="1">
<button class="blue" onclick="addItem()">Add Item</button>

<table>
<thead>
<tr><th>Item</th><th>Qty</th></tr>
</thead>
<tbody id="bill"></tbody>
</table>

<h3>Total Items Sold: <span id="total">0</span></h3>

<hr>
<h3>ğŸ“¦ Stock Status</h3>
<div id="stockList"></div>

<hr>
<button class="gray" onclick="openAudit()">ğŸ“‹ Inventory / Audit (Employee)</button>
<button class="gray" onclick="viewAudit()">ğŸ“Š View Last Audit</button>

<!-- ğŸ“‹ AUDIT BOX -->
<div id="auditBox" class="hidden auditBox">
<h3>ğŸ“‹ Manual Inventory Audit</h3>
<input id="empName" placeholder="Employee Name">
<div id="auditList"></div>
<button class="green" onclick="saveAudit()">Save Inventory</button>
<button class="red" onclick="closeAudit()">Close</button>
</div>

</div>

<script>
// ğŸ” LOGIN DETAILS
const OWNER_ID = "ASM-01";
const OWNER_PASS = "1234";

// ğŸ“¦ INVENTORY DATA
let stock = JSON.parse(localStorage.getItem("STOCK")) || {
  "111":{name:"Rice",qty:50,min:10},
  "222":{name:"Oil",qty:20,min:5},
  "333":{name:"Sugar",qty:30,min:8}
};

let totalItems = 0;

// ğŸ”‘ LOGIN
function login(){
  if(uid.value===OWNER_ID && pass.value===OWNER_PASS){
    localStorage.setItem("ASM_LOGIN","YES");
    showDashboard();
  }else{
    msg.innerText="âŒ Invalid ID or Password";
  }
}

// ğŸ”“ LOGOUT
function logout(){
  localStorage.removeItem("ASM_LOGIN");
  location.reload();
}

// ğŸ§¾ BILLING
function addItem(){
  let code = barcode.value;
  let q = Number(qty.value);

  if(!stock[code]) return alert("Item not found");
  if(stock[code].qty < q) return alert("âŒ Stock not enough");

  stock[code].qty -= q;
  totalItems += q;

  bill.innerHTML += `<tr><td>${stock[code].name}</td><td>${q}</td></tr>`;
  total.innerText = totalItems;

  saveStock();
  showStock();
  barcode.value="";
}

// ğŸ“¦ SHOW STOCK
function showStock(){
  let html="";
  for(let k in stock){
    html += `${stock[k].name} : ${stock[k].qty}`;
    if(stock[k].qty <= stock[k].min){
      html += ` <span class="low">(LOW)</span>`;
    }
    html += "<br>";
  }
  stockList.innerHTML = html;
}

// ğŸ’¾ SAVE STOCK
function saveStock(){
  localStorage.setItem("STOCK",JSON.stringify(stock));
}

// ğŸ–¥ï¸ DASHBOARD
function showDashboard(){
  loginBox.classList.add("hidden");
  dashboard.classList.remove("hidden");
  showStock();
}

// ğŸ” AUTO LOGIN
if(localStorage.getItem("ASM_LOGIN")==="YES"){
  showDashboard();
}

// =======================
// ğŸ“‹ INVENTORY / AUDIT
// =======================

function openAudit(){
  auditBox.classList.remove("hidden");
  let html="";
  for(let code in stock){
    html+=`
      <b>${stock[code].name}</b><br>
      System Stock: ${stock[code].qty}<br>
      Actual Stock:
      <input type="number" id="a_${code}" value="${stock[code].qty}">
      <hr>
    `;
  }
  auditList.innerHTML=html;
}

function saveAudit(){
  if(empName.value==="") return alert("Employee name required");

  let report=[];
  for(let code in stock){
    let actual = Number(document.getElementById("a_"+code).value);
    let system = stock[code].qty;
    let diff = actual - system;

    report.push({
      item: stock[code].name,
      system,
      actual,
      difference: diff
    });

    stock[code].qty = actual;
  }

  let auditRecord = {
    employee: empName.value,
    date: new Date().toLocaleString(),
    report
  };

  localStorage.setItem("LAST_AUDIT",JSON.stringify(auditRecord));
  saveStock();

  alert("âœ… Inventory Audit Saved");
  closeAudit();
  showStock();
}

function closeAudit(){
  auditBox.classList.add("hidden");
}

// ğŸ“Š VIEW AUDIT
function viewAudit(){
  let data = JSON.parse(localStorage.getItem("LAST_AUDIT"));
  if(!data) return alert("No audit found");

  let msg = `EMPLOYEE: ${data.employee}\nDATE: ${data.date}\n\n`;
  data.report.forEach(i=>{
    msg += `${i.item} | System: ${i.system} | Actual: ${i.actual} | Diff: ${i.difference}\n`;
  });
  alert(msg);
}
</script>

</body>
</html>
