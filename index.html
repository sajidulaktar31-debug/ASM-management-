<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aktar Super Mart ‚Äì POS & Inventory</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f2f2f2;margin:0;padding:10px}
.hidden{display:none}
.box{background:#fff;padding:15px;border-radius:8px;max-width:420px;margin:20px auto}
input,button{width:100%;padding:10px;margin:6px 0}
button{border:none;color:#fff;font-size:15px;border-radius:5px}
.green{background:#28a745}
.blue{background:#007bff}
.red{background:#dc3545}
.gray{background:#6c757d}
table{width:100%;border-collapse:collapse;margin-top:10px}
td,th{border:1px solid #ccc;padding:6px;text-align:center}
.low{color:red;font-weight:bold}
.expire{color:darkred;font-weight:bold}
</style>
</head>

<body>

<!-- üîê LOGIN -->
<div id="loginBox" class="box">
<h3>üîê Login</h3>
<select id="role">
  <option value="owner">Owner</option>
  <option value="employee">Employee</option>
</select>
<input id="uid" placeholder="ID Card Number">
<input id="pass" type="password" placeholder="Password">
<button class="green" onclick="login()">Login</button>
<p id="msg" style="color:red"></p>
</div>

<!-- üßæ OWNER DASHBOARD -->
<div id="ownerDash" class="hidden box">
<h2>üßæ Aktar Super Mart ‚Äì Owner</h2>
<button class="red" onclick="logout()">Logout</button>

<input id="barcode" placeholder="Scan Barcode">
<input id="qty" type="number" value="1" min="1">
<button class="blue" onclick="sell()">Add Item</button>

<table>
<thead><tr><th>Item</th><th>Qty</th></tr></thead>
<tbody id="bill"></tbody>
</table>

<h3>Total Items Sold: <span id="total">0</span></h3>

<hr>
<h3>üì¶ Stock + Expiry</h3>
<div id="stockView"></div>

<hr>
<button class="gray" onclick="openAudit()">üìã Inventory / Audit</button>
<button class="gray" onclick="viewAudit()">üìä View Last Audit</button>
</div>

<!-- üë§ EMPLOYEE AUDIT -->
<div id="employeeDash" class="hidden box">
<h3>üìã Employee Inventory Audit</h3>
<input id="empName" placeholder="Employee Name">
<div id="auditList"></div>
<button class="green" onclick="saveAudit()">Save Inventory</button>
<button class="red" onclick="logout()">Logout</button>
</div>

<script>
// ================= AUTH =================
const OWNER_ID="ASM-01", OWNER_PASS="1234";
const EMP_ID="EMP-01", EMP_PASS="0000";

function login(){
  if(role.value==="owner" && uid.value===OWNER_ID && pass.value===OWNER_PASS){
    localStorage.setItem("LOGIN","OWNER");
    showOwner();
  }else if(role.value==="employee" && uid.value===EMP_ID && pass.value===EMP_PASS){
    localStorage.setItem("LOGIN","EMP");
    showEmployee();
  }else msg.innerText="‚ùå Invalid Login";
}

function logout(){
  localStorage.clear();
  location.reload();
}

// ================= DATA =================
let stock = JSON.parse(localStorage.getItem("STOCK")) || {
 "111":{name:"Rice",qty:50,min:10,exp:"2026-03-01",cost:30,price:40},
 "222":{name:"Oil",qty:20,min:5,exp:"2026-02-15",cost:110,price:130},
 "333":{name:"Sugar",qty:30,min:8,exp:"2026-01-20",cost:38,price:45}
};

let total=0;
let lastAudit = localStorage.getItem("LAST_AUDIT_DATE");

// ================= OWNER =================
function showOwner(){
 loginBox.classList.add("hidden");
 ownerDash.classList.remove("hidden");
 showStock();
}

function sell(){
 let c=barcode.value, q=Number(qty.value);
 if(!stock[c]) return alert("Item not found");

 let exp=new Date(stock[c].exp);
 if(exp < new Date()) return alert("‚ùå Item Expired");

 if(stock[c].qty<q) return alert("‚ùå Not enough stock");

 stock[c].qty-=q;
 total+=q;
 bill.innerHTML+=`<tr><td>${stock[c].name}</td><td>${q}</td></tr>`;
 total.innerText=total;
 save();
 showStock();
 barcode.value="";
}

function showStock(){
 let html="";
 for(let k in stock){
  let d=(new Date(stock[k].exp)-new Date())/86400000;
  html+=`${stock[k].name} : ${stock[k].qty}`;
  if(stock[k].qty<=stock[k].min) html+=` <span class="low">(LOW)</span>`;
  if(d<=30) html+=` <span class="expire">(EXP ${Math.ceil(d)}d)</span>`;
  html+="<br>";
 }
 stockView.innerHTML=html;
}

function save(){
 localStorage.setItem("STOCK",JSON.stringify(stock));
}

// ================= AUDIT (WEEKLY LOCK) =================
function openAudit(){
 if(lastAudit){
  let diff=(Date.now()-new Date(lastAudit))/86400000;
  if(diff<7) return alert("‚ùå Inventory already done this week");
 }
 ownerDash.classList.add("hidden");
 employeeDash.classList.remove("hidden");
 let html="";
 for(let k in stock){
  html+=`${stock[k].name}<br>
  System: ${stock[k].qty}<br>
  Actual: <input type="number" id="a_${k}" value="${stock[k].qty}"><hr>`;
 }
 auditList.innerHTML=html;
}

function saveAudit(){
 if(empName.value==="") return alert("Employee name required");
 let report=[];
 for(let k in stock){
  let a=Number(document.getElementById("a_"+k).value);
  report.push({item:stock[k].name,system:stock[k].qty,actual:a,diff:a-stock[k].qty});
  stock[k].qty=a;
 }
 let rec={emp:empName.value,date:new Date().toLocaleString(),report};
 localStorage.setItem("LAST_AUDIT",JSON.stringify(rec));
 localStorage.setItem("LAST_AUDIT_DATE",new Date());
 save();
 alert("‚úÖ Inventory Saved");
 logout();
}

function viewAudit(){
 let d=JSON.parse(localStorage.getItem("LAST_AUDIT"));
 if(!d) return alert("No audit found");
 let m=`EMP: ${d.emp}\nDATE: ${d.date}\n\n`;
 d.report.forEach(i=>m+=`${i.item} | Sys:${i.system} Act:${i.actual} Diff:${i.diff}\n`);
 alert(m);
}

// ================= AUTO LOGIN =================
if(localStorage.getItem("LOGIN")==="OWNER") showOwner();
if(localStorage.getItem("LOGIN")==="EMP") showEmployee();
</script>

</body>
</html>
